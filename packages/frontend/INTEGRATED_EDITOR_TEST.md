# 整合编辑器测试文档

## 功能概述

整合编辑器将题目编辑页面的题面部分整合成一个大的Typst编辑器，具有以下特点：

1. **元数据注释**：题目来源和题目标识以注释形式显示在文档顶部
2. **二级标题**：各个模块（题目背景、题目描述、输入格式、输出格式等）作为二级标题显示
3. **样例部分**：样例输入、样例输出和样例说明以结构化方式显示

## 整合编辑器结构

```typst
/* 题目来源: CF */
/* 题目标识: CF1234A */

= CF

== 题目背景

这是一道关于动态规划的题目。

== 题目描述

给定一个长度为n的数组，求最长递增子序列的长度。

== 输入格式

第一行输入一个整数n，表示数组长度。
第二行输入n个整数，表示数组元素。

== 输出格式

输出一个整数，表示最长递增子序列的长度。

== 样例

=== 样例 1

*输入*

```
5
1 2 3 4 5
```

*输出*

```
5
```

*说明*

整个数组都是递增的

=== 样例 2

*输入*

```
5
5 4 3 2 1
```

*输出*

```
1
```

*说明*

每个元素单独构成一个递增子序列
```

## 使用方法

### 1. 在题目编辑页面切换到整合编辑模式

在题目编辑页面，点击"整合编辑"标签页即可切换到整合编辑模式。

### 2. 编辑内容

在整合编辑器中，您可以：
- 使用 `== 标题` 创建二级标题（对应各个模块）
- 使用 `=== 标题` 创建三级标题（对应各个样例）
- 使用 `*文本*` 创建强调文本（如 *输入*、*输出*、*说明*）
- 使用 ``` 创建代码块（用于样例输入和输出）

### 3. 预览效果

点击"预览"按钮可以查看Typst文档的渲染效果。

### 4. 保存更改

编辑完成后，点击"保存更改"按钮保存题目。

## 数据同步

整合编辑器与模块化编辑器之间的数据是双向同步的：

1. **从模块化到整合**：切换到整合编辑模式时，系统会自动将所有模块和样例合并为一个Typst文档
2. **从整合到模块化**：在整合编辑器中修改内容后，系统会自动解析文档并更新各个模块和样例

## 测试步骤

### 测试1：基本功能测试

1. 打开题目编辑页面
2. 切换到"整合编辑"模式
3. 查看是否正确显示了所有模块内容
4. 修改某个模块的内容
5. 切换回"模块化编辑"模式
6. 验证修改是否正确同步到对应的模块

### 测试2：样例编辑测试

1. 在整合编辑器中添加新的样例
2. 使用以下格式：
   ```typst
   === 样例 3
   
   *输入*
   
   ```
   3
   1 2 3
   ```
   
   *输出*
   
   ```
   3
   ```
   ```
3. 切换到模块化编辑模式
4. 验证新样例是否正确显示

### 测试3：元数据编辑测试

1. 在整合编辑器中修改元数据注释：
   ```typst
   /* 题目来源: ATCoder */
   /* 题目标识: ABC123A */
   ```
2. 切换到模块化编辑模式
3. 验证题目来源和题目标识是否正确更新

### 测试4：预览功能测试

1. 在整合编辑器中编辑内容
2. 点击"预览"按钮
3. 验证预览效果是否正确显示

## 注意事项

1. **标题格式**：必须使用 `==` 作为二级标题，`===` 作为三级标题
2. **样例格式**：样例必须放在"== 样例"标题下
3. **代码块**：样例输入和输出必须使用 ``` 包裹
4. **强调文本**：使用 *文本* 格式来标记输入、输出、说明等标签
5. **元数据**：元数据注释必须放在文档最前面

## 常见问题

### Q1: 修改内容后切换模式，内容丢失了怎么办？

A: 请检查编辑的内容是否符合Typst语法格式，特别是标题和代码块的格式是否正确。

### Q2: 样例没有正确解析怎么办？

A: 请确保样例使用了正确的格式：
- 必须有 `=== 样例 X` 三级标题
- 输入输出必须使用 ``` 代码块包裹
- 必须有 *输入*、*输出* 等标签

### Q3: 如何添加新的模块？

A: 在整合编辑器中添加新的二级标题即可，例如：
```typst
== 提示

这是一些提示信息。
```

系统会自动识别新模块并在模块化编辑模式中显示。
